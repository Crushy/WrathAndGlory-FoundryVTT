<div class="wrath-and-glory chat roll">
    <div class="wrapper">
        <h3>{{context.title}}</h3>

        <h4>{{localize "CHAT.DN"}} {{result.dn}}</h4>
        <div class="dice-container">
            {{#each result.dice as |die|}}
            <a class="die {{die.name}} unshifted" data-index="{{die.index}}"><img src="{{die.img}}.png"/>
                {{#if die.rerolled}}
                        <span class="reroll die-icon"><i class="fas fa-redo"></i></span>
                {{/if}}    
            </a>
            {{/each}}
        </div>
        {{#if result.shifted.length}}
        <hr>
        <h4>Shifted</h4>
        <div class="dice-container">
                {{#each result.shifted as |die|}}
                <a class="die {{die.name}} shifted" data-index="{{die.index}}"><img src="{{die.img}}.png"/>
                        {{log die}}
                        {{#if (eq die.shift "glory")}}
                        <span class="glory die-icon">G</span>
                        {{/if}}
                        {{#if (eq die.shift "damage")}} 
                        <span class="damage die-icon">D</span>
                        {{/if}}
                        {{#if (eq die.shift "other")}} 
                        <span class="other die-icon">?</span>
                        {{/if}}
                        {{#if die.rerolled}}
                        <span class="reroll die-icon"><i class="fas fa-redo"></i></span>
                        {{/if}}   
                </a>
                {{/each}}
        </div>
        {{/if}}

    </div>
    <div class="wrapper-input">
        {{#if result.isSuccess}}
        <div class="seal approved"></div>
        {{else}}
        <div class="seal heresy"></div>
        {{/if}}
        <p><strong>{{localize "CHAT.SUCCESS"}}: {{result.success}}</strong></p>
        <p><strong>{{localize "CHAT.FAILURE"}}: {{result.failure}}</strong></p>
        {{#if result.isSuccess}}
        <p><strong>{{localize "CHAT.SHIFTING"}}: {{result.shiftsPossible}}</strong></p>
        {{/if}}

        {{#if result.isWrathCritical}}
        {{#if weapon}}
        <p><strong style="color: var(--color-red)">{{localize "CHAT.WRATH_CRITICAL_TITLE"}}</strong><strong>:
                {{localize "CHAT.WRATH_CRITICAL_WEAPON"}}</strong></p>
        {{else if power}}
        <p><strong style="color: var(--color-red)">{{localize "CHAT.WRATH_CRITICAL_TITLE"}}</strong><strong>:
                {{localize "CHAT.WRATH_CRITICAL_PSY"}}</strong></p>
        {{else if corruption}}
        <p><strong style="color: var(--color-red)">{{localize "CHAT.WRATH_CRITICAL_TITLE"}}</strong><strong>:
                {{localize "CHAT.WRATH_CRITICAL_CORRUPTION"}}</strong></p>
        {{else}}
        <p><strong style="color: var(--color-red)">{{localize "CHAT.WRATH_CRITICAL_TITLE"}}</strong><strong>:
                {{#if (eq actor.type "agent")}}
                {{localize "CHAT.WRATH_CRITICAL_COMMON_GLORY"}}
                {{else if (eq actor.type "threat")}}
                {{localize "CHAT.WRATH_CRITICAL_COMMON_RUIN"}}
                {{/if}}
        
        </strong></p>
       
        {{/if}}
        {{/if}}
        {{#if result.isWrathComplication}}
        {{#if weapon}}
        <p><strong style="color: var(--color-red)">{{localize "CHAT.WRATH_COMPLICATION_TITLE"}}</strong><strong>:
                {{localize "CHAT.WRATH_COMPLICATION_WEAPON"}}</strong></p>
        {{else if power}}
        <p><strong style="color: var(--color-red)">{{localize "CHAT.WRATH_COMPLICATION_TITLE"}}</strong><strong>:
                {{localize "CHAT.WRATH_COMPLICATION_PSY"}}</strong></p>
        {{else if corruption}}
        <p><strong style="color: var(--color-red)">{{localize "CHAT.WRATH_COMPLICATION_TITLE"}}</strong><strong>:
                {{localize "CHAT.WRATH_COMPLICATION_CORRUPTION"}}</strong></p>
        {{else}}
        <p><strong style="color: var(--color-red)">{{localize "CHAT.WRATH_COMPLICATION_TITLE"}}</strong><strong>:
                {{localize "CHAT.WRATH_COMPLICATION_COMMON"}}</strong></p>

        {{/if}}
        {{/if}}

        
        {{#if result.isSuccess}}
        
        {{else}}
            {{#if fear}}
            <p><strong>{{localize "CHAT.FAIL_FEAR"}}</strong></p>
            {{/if}}
        {{/if}}

    </div>
    {{#if result.damage}}
    <div class="wrapper">
        <button type="button" class="roll-damage">Roll Damage</button>
    </div>
    {{/if}}
    {{#if result.isWrathComplication}}
        {{#if weapon}}
        <div class="wrapper">
                <button type="button" class="roll-wrath">Roll Complication</button>
        </div>
        {{else if power}}
        <div class="wrapper">
                <button type="button" class="roll-wrath">Perils of the Warp</button>
        </div>
        {{else if corruption}}
        
        {{else if mutation}}

        {{else}}
        <div class="wrapper">
                <button type="button" class="roll-wrath">Roll Complication</button>
        </div>
        {{/if}}
    {{/if}}

        {{#if result.isWrathCritical}}
                {{#if weapon}}
                <div class="wrapper">
                        <button type="button" class="roll-wrath">Roll Critical Hit</button>
                </div>
                {{/if}}
        {{/if}}

        {{#if result.mutation}}
        <div class="wrapper">
                <button type="button" class="roll-mutation">Roll Mutation</button>
        </div>
        {{/if}}

        {{#if showEffects}}
        <hr>
        <div class="wrapper">
                {{#each testEffects as |effect e|}}
                <button type="button" data-id="{{effect.id}}" class="test-effect"><img height="20" width="20" src="{{effect.data.icon}}"> Apply {{effect.label}}</button>
                {{/each}}
        </div>
        {{/if}}

        {{#if showTest}}
        <hr>
        <div class="wrapper">
                <button type="button" class="invoke-test">{{testDisplay}}</button>
        </div>
        {{/if}}

</div>
</div>